{% extends "base_app.html" %}
{% block content %}

<div class="mb-4">
 <h4 class="mb-1">
  <i class="fas fa-chart-line me-2"></i>Manager Dashboard
 </h4>
 <p class="text-muted mb-0" style="font-size:13px">Welcome {{ user.get_full_name|default:user.username }}</p>
</div>

<div class="row g-3 mb-4">
 <div class="col-md-4">
  <div class="stat-box">
   <div class="d-flex justify-content-between align-items-center">
    <div>
     <p class="text-muted mb-1" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px">Total Employees</p>
     <h3 class="mb-0 fw-semibold">{{ total_employees }}</h3>
    </div>
    <i class="fas fa-users fa-2x" style="color:#cbd5e1"></i>
   </div>
  </div>
 </div>
 <div class="col-md-4">
  <div class="stat-box">
   <div class="d-flex justify-content-between align-items-center">
    <div>
     <p class="text-muted mb-1" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px">Pending Requests</p>
     <h3 class="mb-0 fw-semibold">{{ pending }}</h3>
    </div>
    <i class="fas fa-clock fa-2x" style="color:#cbd5e1"></i>
   </div>
  </div>
 </div>
 <div class="col-md-4">
  <div class="stat-box">
   <div class="d-flex justify-content-between align-items-center">
    <div>
     <p class="text-muted mb-1" style="font-size:12px;text-transform:uppercase;letter-spacing:0.5px">Approved Requests</p>
     <h3 class="mb-0 fw-semibold">{{ approved }}</h3>
    </div>
    <i class="fas fa-check-circle fa-2x" style="color:#cbd5e1"></i>
   </div>
  </div>
 </div>
</div>

<div class="card mb-4">
 <h5 class="mb-3">
  <i class="fas fa-hourglass-half me-2"></i>Pending Leave Requests
 </h5>
 {% if pending_leaves %}
  <div class="table-responsive">
   <table class="table mb-0">
    <thead>
     <tr>
      <th>Employee</th>
      <th>Leave Period</th>
      <th>Type</th>
      <th>Reason</th>
      <th>Submitted</th>
      <th style="width:200px">Action</th>
     </tr>
    </thead>
    <tbody>
     {% for l in pending_leaves %}
     <tr>
      <td>
       <div class="fw-semibold">{{ l.user.get_full_name|default:l.user.username }}</div>
       <small class="text-muted">{{ l.user.email }}</small>
      </td>
      <td>
       <div style="font-size:13px">{{ l.start_date|date:"d M Y" }}</div>
       <small class="text-muted">to {{ l.end_date|date:"d M Y" }}</small>
      </td>
      <td>
       <span class="badge bg-secondary">{{ l.get_leave_type_display }}</span>
      </td>
      <td style="max-width:200px">
       <small>{{ l.reason|truncatewords:15 }}</small>
      </td>
      <td>
       <small class="text-muted">{{ l.created_at|date:"d M Y" }}</small>
      </td>
      <td>
       <form method="post" action="{% url 'leaves:approve_leave' l.id %}" class="mb-2">
        {% csrf_token %}
        <input name="comment" class="form-control form-control-sm mb-1" placeholder="Comment (optional)" style="font-size:12px">
        <button class="btn btn-sm btn-slate w-100" type="submit">
         <i class="fas fa-check me-1"></i>Approve
        </button>
       </form>
       <form method="post" action="{% url 'leaves:reject_leave' l.id %}">
        {% csrf_token %}
        <input name="comment" class="form-control form-control-sm mb-1" placeholder="Comment (optional)" style="font-size:12px">
        <button class="btn btn-sm w-100" type="submit" style="background:#ef4444;color:white;border:none;border-radius:6px;padding:0.375rem 0.5rem;font-weight:500">
         <i class="fas fa-times me-1"></i>Reject
        </button>
       </form>
      </td>
     </tr>
     {% endfor %}
    </tbody>
   </table>
  </div>
 {% else %}
  <div class="text-center text-muted py-5">
   <i class="fas fa-inbox fa-3x mb-3 d-block" style="opacity:0.3"></i>
   <p>No pending requests</p>
  </div>
 {% endif %}
</div>

<div class="card">
 <h5 class="mb-3">
  <i class="fas fa-users me-2"></i>Employee Leave Summary ({{ total_employees }})
 </h5>
 <div class="table-responsive">
  <table class="table mb-0">
   <thead>
    <tr>
     <th>Employee Name</th>
     <th>Email</th>
     <th>Role</th>
     <th>Total Balance</th>
     <th>Used</th>
     <th>Remaining</th>
    </tr>
   </thead>
   <tbody>
    {% for e in employees %}
    <tr>
     <td class="fw-semibold">{{ e.user.get_full_name|default:e.user.username }}</td>
     <td><small class="text-muted">{{ e.user.email }}</small></td>
     <td>
      <span class="badge" style="background:#f1f5f9;color:#475569">{{ e.role|title }}</span>
     </td>
     <td>{{ e.balance.total_balance }} days</td>
     <td>
      <span class="text-muted">{{ e.balance.sick_used|add:e.balance.casual_used|add:e.balance.other_used }} days</span>
     </td>
     <td>
      <span class="fw-semibold" style="color:{% if e.remaining <= 5 %}#ef4444{% elif e.remaining <= 10 %}#f59e0b{% else %}#10b981{% endif %}">
       {{ e.remaining }} days
      </span>
     </td>
    </tr>
    {% endfor %}
   </tbody>
  </table>
 </div>
</div>

{% endblock %}
