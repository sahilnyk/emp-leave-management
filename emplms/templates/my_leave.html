{% extends "base_app.html" %}
{% block content %}

<div class="mb-4">
 <div class="d-flex justify-content-between align-items-center">
  <div>
   <h4 class="mb-1">My Leave Requests</h4>
   <p class="text-muted mb-0" style="font-size:13px">You have <strong>{{ leaves|length }}</strong> request{% if leaves|length != 1 %}s{% endif %}</p>
  </div>
  <a href="/leaves/apply/" class="btn btn-slate">
   <i class="fas fa-plus me-1"></i>Apply for Leave
  </a>
 </div>
</div>

<div class="card">
 {% if leaves %}
  <div class="table-responsive">
   <table class="table mb-0">
    <thead>
     <tr>
      <th>Type</th>
      <th>Leave Period</th>
      <th>Days</th>
      <th>Status</th>
      <th>Reason</th>
      <th>Submitted</th>
     </tr>
    </thead>
    <tbody>
     {% for leave in leaves %}
     <tr>
      <td>
       <span class="badge bg-secondary">{{ leave.get_leave_type_display }}</span>
      </td>
      <td>
       <div style="font-size:13px">{{ leave.start_date|date:"d M Y" }}</div>
       <small class="text-muted">to {{ leave.end_date|date:"d M Y" }}</small>
      </td>
      <td>
       {% with days=leave.end_date|timesince:leave.start_date %}
        <span class="fw-semibold">{{ leave.days }} day{% if leave.days != 1 %}s{% endif %}</span>
       {% endwith %}
      </td>
      <td>
       {% if leave.status|lower == "approved" %}
        <span class="badge bg-success"><i class="fas fa-check-circle me-1"></i>Approved</span>
       {% elif leave.status|lower == "rejected" %}
        <span class="badge bg-danger"><i class="fas fa-times-circle me-1"></i>Rejected</span>
       {% else %}
        <span class="badge bg-warning text-dark"><i class="fas fa-clock me-1"></i>Pending</span>
       {% endif %}
       {% if leave.manager %}
        <div class="mt-1"><small class="text-muted">by {{ leave.manager.get_full_name|default:leave.manager.username }}</small></div>
       {% endif %}
      </td>
      <td style="max-width:250px">
       <small>{{ leave.reason|truncatewords:20 }}</small>
       {% if leave.manager_comment %}
        <div class="mt-1 p-2" style="background:#f8fafc;border-radius:4px;border-left:2px solid #cbd5e1">
         <small class="text-muted"><strong>Manager:</strong> {{ leave.manager_comment }}</small>
        </div>
       {% endif %}
      </td>
      <td>
       <small class="text-muted">{{ leave.created_at|date:"d M Y H:i" }}</small>
      </td>
     </tr>
     {% endfor %}
    </tbody>
   </table>
  </div>
 {% else %}
  <div class="text-center text-muted py-5">
   <i class="fas fa-inbox fa-3x mb-3 d-block" style="opacity:0.3"></i>
   <p class="mb-3">No leave requests yet</p>
   <a href="/leaves/apply/" class="btn btn-slate">
    <i class="fas fa-plus me-1"></i>Apply for Leave
   </a>
  </div>
 {% endif %}
</div>

{% endblock %}
